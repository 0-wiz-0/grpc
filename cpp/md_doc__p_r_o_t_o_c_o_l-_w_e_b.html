<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>GRPC C++: gRPC Web</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">GRPC C++
   &#160;<span id="projectnumber">1.6.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">gRPC Web </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>gRPC-Web provides a JS client library that supports the same API as gRPC-Node to access a gRPC service. Due to browser limitation, the Web client library implements a different protocol than the <a href="https://grpc.io/docs/guides/wire.html">native gRPC protocol</a>. This protocol is designed to make it easy for a proxy to translate between the protocols as this is the most likely deployment model.</p>
<p>This document lists the differences between the two protocols. To help tracking future revisions, this document describes a delta with the protocol details specified in the <a href="https://grpc.io/docs/guides/wire.html">native gRPC protocol</a>.</p>
<h1>Design goals</h1>
<p>For the gRPC-Web protocol, we have decided on the following design goals:</p>
<ul>
<li>adopt the same framing as “application/grpc” whenever possible</li>
<li>decouple from HTTP/2 framing which is not, and will never, be directly exposed by browsers</li>
<li>support text streams (e.g. base64) in order to provide cross-browser support (e.g. IE-10)</li>
</ul>
<p>While the new protocol will be published/reviewed publicly, we also intend to keep the protocol as an internal detail to gRPC-Web. More specifically, we expect the protocol to</p>
<ul>
<li>evolve over time, mainly to optimize for browser clients or support web-specific features such as CORS, XSRF</li>
<li>become optional (in 1-2 years) when browsers are able to speak the native gRPC protocol via the new <a href="https://github.com/whatwg/fetch">whatwg fetch/streams API</a></li>
</ul>
<h1>Protocol differences vs <a href="https://grpc.io/docs/guides/wire.html">gRPC over HTTP2</a></h1>
<p>Content-Type</p>
<ol type="1">
<li>application/grpc-web<ul>
<li>e.g. application/grpc-web+[proto, json, thrift]</li>
<li>the sender should always specify the message format, e.g. +proto, +json</li>
<li>the receiver should assume the default is "+proto" when the message format is missing in Content-Type (as "application/grpc-web")</li>
</ul>
</li>
<li>application/grpc-web-text<ul>
<li>text-encoded streams of “application/grpc-web”</li>
<li>e.g. application/grpc-web-text+[proto, thrift] <hr/>
</li>
</ul>
</li>
</ol>
<p>HTTP wire protocols</p>
<ol type="1">
<li>support any HTTP/*, with no dependency on HTTP/2 specific framing</li>
<li>use lower-case header/trailer names</li>
<li>use EOF (end of body) to close the stream <hr/>
</li>
</ol>
<p>HTTP/2 related behavior (specified in <a href="https://grpc.io/docs/guides/wire.html">gRPC over HTTP2</a>)</p>
<ol type="1">
<li>stream-id is not supported or used</li>
<li>go-away is not supported or used <hr/>
</li>
</ol>
<p>Message framing (vs. <a href="https://grpc.io/docs/guides/wire.html#http2-transport-mapping">http2-transport-mapping</a>)</p>
<ol type="1">
<li>Response status encoded as part of the response body<ul>
<li>Key-value pairs encoded as a HTTP/1 headers block (without the terminating newline), per <a href="https://tools.ietf.org/html/rfc7230#section-3.2">https://tools.ietf.org/html/rfc7230#section-3.2</a> ``` key1: foo<br/>
 key2: bar<br/>
 ```</li>
</ul>
</li>
<li>8th (MSB) bit of the 1st gRPC frame byte<ul>
<li>0: data</li>
<li>1: trailers ``` 10000000b: an uncompressed trailer (as part of the body) 10000001b: a compressed trailer ```</li>
</ul>
</li>
<li>Trailers must be the last message of the response, as enforced by the implementation</li>
<li>Trailers-only responses: no change to the gRPC protocol spec. Trailers may be sent together with response headers, with no message in the body. <hr/>
</li>
</ol>
<p>User Agent</p>
<ul>
<li>Do NOT use User-Agent header (which is to be set by browsers, by default)</li>
<li>Use X-User-Agent: grpc-web-javascript/0.1 (follow the same format as specified in <a href="https://grpc.io/docs/guides/wire.html">gRPC over HTTP2</a>) <hr/>
</li>
</ul>
<p>Text-encoded (response) streams</p>
<ol type="1">
<li>The client library should indicate to the server via the "Accept" header that the response stream needs to be text encoded e.g. when XHR is used or due to security policies with XHR<ul>
<li>Accept: application/grpc-web-text</li>
</ul>
</li>
<li>The default text encoding is base64<ul>
<li>Note that “Content-Transfer-Encoding: base64” should not be used. Due to in-stream base64 padding when delimiting messages, the entire response body is not necessarily a valid base64-encoded entity</li>
<li>While the server runtime will always base64-encode and flush gRPC messages atomically the client library should not assume base64 padding always happens at the boundary of message frames. That is, the implementation may send base64-encoded "chunks" with potential padding whenever the runtime needs to flush a byte buffer.</li>
</ul>
</li>
</ol>
<h1>Other features</h1>
<p>Compression</p>
<ul>
<li>Full-body compression is supported and expected for all unary requests/responses. The compression/decompression will be done by browsers, using standard Content-Encoding headers<ul>
<li>“grpc-encoding” header is not used</li>
<li>SDCH, Brotli will be supported</li>
</ul>
</li>
<li>Message-level compression for streamed requests/responses is not supported because manual compression/decompression is prohibitively expensive using JS<ul>
<li>Per-message compression may be feasible in future with wasm <hr/>
</li>
</ul>
</li>
</ul>
<p>Retries, caching</p>
<ul>
<li>Will spec out the support after their respective gRPC spec extensions are finalized<ul>
<li>Safe retries: PUT</li>
<li>Caching: header encoded request and/or a web specific spec <hr/>
</li>
</ul>
</li>
</ul>
<p>Security</p>
<ul>
<li>XSRF, XSS etc to be specified <hr/>
</li>
</ul>
<p>CORS preflight</p>
<ul>
<li>Should follow the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Server-Side_Access_Control">CORS spec</a><ul>
<li>Access-Control-Allow-Credentials to allow Authorization headers</li>
<li>Access-Control-Allow-Methods to allow POST and (preflight) OPTIONS only</li>
<li>Access-Control-Allow-Headers to whatever the preflight request carries</li>
</ul>
</li>
<li>The client library may support header overwrites to avoid preflight<ul>
<li><a href="https://github.com/whatwg/fetch/issues/210">https://github.com/whatwg/fetch/issues/210</a></li>
</ul>
</li>
<li>CSP support to be specified <hr/>
</li>
</ul>
<p>Keep-alive</p>
<ul>
<li>HTTP/2 PING is not supported or used</li>
<li>Will not support send-beacon (GET) <hr/>
</li>
</ul>
<p>Bidi-streaming, with flow-control</p>
<ul>
<li>Pending on <a href="https://github.com/whatwg/fetch">whatwg fetch/streams</a> to be finalized and implemented in modern browsers</li>
<li>gRPC-Web client will support the native gRPC protocol with modern browsers <hr/>
</li>
</ul>
<p>Versioning</p>
<ul>
<li>Special headers may be introduced to support features that may break compatiblity. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 8 2017 09:46:06 for GRPC C++ by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
