<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>GRPC C++: gRPC Server Reflection Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">GRPC C++
   &#160;<span id="projectnumber">1.6.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">gRPC Server Reflection Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>gRPC Server Reflection provides information about publicly-accessible gRPC services on a server, and assists clients at runtime to construct RPC requests and responses without precompiled service information. It is used by gRPC CLI, which can be used to introspect server protos and send/receive test RPCs.</p>
<h2>Enable Server Reflection</h2>
<h3>Enable server reflection in C++ servers</h3>
<p>C++ Server Reflection is an add-on library, <code>libgrpc++_reflction</code>. To enable C++ server reflection, you can link this library to your server binary.</p>
<p>Some platforms (e.g. Ubuntu 11.10 onwards) only link in libraries that directly contain symbols used by the application. On these platforms, LD flag <code>--no-as-needed</code> is needed for for dynamic linking and <code>--whole-archive</code> is needed for for static linking.</p>
<p>This <a href="../examples/cpp/helloworld/Makefile#L37#L45">Makefile</a> demonstrates enabling c++ server reflection on Linux and MacOS.</p>
<h2>Test services using Server Reflection</h2>
<p>After enabling Server Reflection in a server application, you can use gRPC CLI to test its services.</p>
<p>Instructions on how to use gRPC CLI can be found at <a class="el" href="command__line__tool_8md.html">command_line_tool.md</a>, or using <code>grpc_cli help</code> command.</p>
<p>Here we use <code>examples/cpp/helloworld</code> as an example to show the use of gRPC Server Reflection and gRPC CLI. First, we need to build gRPC CLI and setup an example server with Server Reflection enabled.</p>
<ul>
<li><p class="startli">Setup an example server</p>
<p class="startli">Server Reflection has already been enabled in the <a href="../examples/cpp/helloworld/Makefile">Makefile</a> of the helloworld example. We can simply make it and run the greeter_server.</p>
<p class="startli">```sh $ make -C examples/cpp/helloworld $ examples/cpp/helloworld/greeter_server &amp; ```</p>
</li>
<li><p class="startli">Build gRPC CLI</p>
<p class="startli">```sh make grpc_cli cd bins/opt ```</p>
<p class="startli">gRPC CLI binary <code>grpc_cli</code> can be found at <code>bins/opt/</code> folder. This tool is still new and does not have a <code>make install</code> target yet.</p>
</li>
</ul>
<h3>List services</h3>
<p><code>grpc_cli ls</code> command lists services and methods exposed at a given port</p>
<ul>
<li><p class="startli">List all the services exposed at a given port</p>
<p class="startli">```sh $ grpc_cli ls localhost:50051 ```</p>
<p class="startli">output: ```sh helloworld.Greeter grpc.reflection.v1alpha.ServerReflection ```</p>
</li>
<li><p class="startli">List one service with details</p>
<p class="startli"><code>grpc_cli ls</code> command inspects a service given its full name (in the format of &lt;package&gt;.&lt;service&gt;). It can print information with a long listing format when <code>-l</code> flag is set. This flag can be used to get more details about a service.</p>
<p class="startli">```sh $ grpc_cli ls localhost:50051 helloworld.Greeter -l ```</p>
<p class="startli">output: ```sh filename: helloworld.proto package: helloworld; service Greeter { rpc SayHello(helloworld.HelloRequest) returns (helloworld.HelloReply) {} }</p>
<p class="startli">```</p>
</li>
</ul>
<h3>List methods</h3>
<ul>
<li><p class="startli">List one method with details</p>
<p class="startli"><code>grpc_cli ls</code> command also inspects a method given its full name (in the format of &lt;package&gt;.&lt;service&gt;.&lt;method&gt;).</p>
<p class="startli">```sh $ grpc_cli ls localhost:50051 helloworld.Greeter.SayHello -l ```</p>
<p class="startli">output: ```sh rpc SayHello(helloworld.HelloRequest) returns (helloworld.HelloReply) {} ```</p>
</li>
</ul>
<h3>Inspect message types</h3>
<p>We can use<code>grpc_cli type</code> command to inspect request/response types given the full name of the type (in the format of &lt;package&gt;.&lt;type&gt;).</p>
<ul>
<li><p class="startli">Get information about the request type</p>
<p class="startli">```sh $ grpc_cli type localhost:50051 helloworld.HelloRequest ```</p>
<p class="startli">output: ```sh message HelloRequest { optional string name = 1; } ```</p>
</li>
</ul>
<h3>Call a remote method</h3>
<p>We can send RPCs to a server and get responses using <code>grpc_cli call</code> command.</p>
<ul>
<li><p class="startli">Call a unary method</p>
<p class="startli">```sh $ grpc_cli call localhost:50051 SayHello "name: 'gRPC CLI'" ```</p>
<p class="startli">output: ```sh message: "Hello gRPC CLI" ```</p>
</li>
</ul>
<h2>Use Server Reflection in a C++ client</h2>
<p>Server Reflection can be used by clients to get information about gRPC services at runtime. We've provided a descriptor database called <a href="../test/cpp/util/proto_reflection_descriptor_database.h">grpc::ProtoReflectionDescriptorDatabase</a> which implements the <a href="https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.descriptor_database#DescriptorDatabase">google::protobuf::DescriptorDatabase</a> interface. It manages the communication between clients and reflection services and the storage of received information. Clients can use it as using a local descriptor database.</p>
<ul>
<li><p class="startli">To use Server Reflection with grpc::ProtoReflectionDescriptorDatabase, first initialize an instance with a <a class="el" href="classgrpc_1_1_channel.html" title="Channels represent a connection to an endpoint. Created by CreateChannel. ">grpc::Channel</a>.</p>
<p class="startli">```c++ std::shared_ptr&lt;grpc::Channel&gt; channel = grpc::CreateChannel(server_address, server_cred); grpc::ProtoReflectionDescriptorDatabase reflection_db(channel); ```</p>
</li>
<li><p class="startli">Then use this instance to feed a <a href="https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.descriptor#DescriptorPool">google::protobuf::DescriptorPool</a>.</p>
<p class="startli">```c++ google::protobuf::DescriptorPool desc_pool(&amp;reflection_db); ```</p>
</li>
<li>Example usage of this descriptor pool<ul>
<li><p class="startli">Get Service/method descriptors.</p>
<p class="startli">```c++ const google::protobuf::ServiceDescriptor* service_desc = desc_pool-&gt;FindServiceByName("helloworld.Greeter"); const google::protobuf::MethodDescriptor* method_desc = desc_pool-&gt;FindMethodByName("helloworld.Greeter.SayHello"); ```</p>
</li>
<li><p class="startli">Get message type descriptors.</p>
<p class="startli">```c++ const google::protobuf::Descriptor* request_desc = desc_pool-&gt;FindMessageTypeByName("helloworld.HelloRequest"); ```</p>
</li>
<li><p class="startli">Feed <a href="https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.dynamic_message#DynamicMessageFactory">google::protobuf::DynamicMessageFactory</a>.</p>
<p class="startli">```c++ google::protobuf::DynamicMessageFactory(&amp;desc_pool); ``` </p>
</li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 8 2017 09:46:06 for GRPC C++ by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
